{% macro currentEntryValue(qu) %}
{% if current %}
{% if current.answers[qu.id] %}
{{current.answers[qu.id]}}
{% else %}
{{ gettext("No entry") }}
{% endif %}
{% else %}
{{ gettext("No entry") }}
{% endif %}
{%- endmacro  %}

{% macro currentEntry(qu) %}
<div class="current-entry">
  <label>{{gettext("Current Entry")}}</label>
  <div class="current-entry-value" title="{{ currentEntryValue(qu) }}">
    {{ currentEntryValue(qu) }}
  </div>
</div>
{%- endmacro  %}

{% macro question(qu) -%}
<div class="col-xs-6">
  <h4 class="submission-label">{{qu.question}}</h4>
  <input type="{{qu.type}}" title="{{qu.placeholder}}" name="{{qu.id}}" value="{% if formData %}{{ formData[qu.id] }}{% elif current %}{{current.answers[qu.id]}}{% endif %}" {% if canReview != true or reviewClosed %}disabled="disabled"{% endif %} placeholder="{{qu.placeholder}}" {% if qu.id=='format' %} list="formats" {% endif %} />
</div>
<div class="col-xs-6">
  {{ currentEntry(qu) }}
</div>
<div class="col-xs-12">
  <span class="help-block">{{qu.description}}</span>
</div>
{%- endmacro  %}

<fieldset>
  <div class="container submission-row head">
    <div class="row">
      <div class="col-xs-3 submission-question">Question</div>
      <div class="col-xs-1 submission-option">{{gettext("Yes")}}</div>
      <div class="col-xs-1 submission-option">{{gettext("No")}}</div>
      <div class="col-xs-1 submission-option">{{gettext("Unsure")}}</div>
      <div class="col-xs-2 submission-current">{{gettext("Current")}}</div>
      <div class="col-xs-4 submission-info">{{gettext("Information")}}</div>
    </div>
  </div>

  <div class="yntable">
    {% for qu in questions %}
    {% if qu.type == '' %}
    <div class="submission-row{% if loop.index0 != 0 %} hide js-dependent{% endif %}">
      <div class="row">
        <div class="col-xs-3">
          <div class="submission-question submission-label">{{ qu.question }}?</div>
        </div>
        {% for val in [
            {"type": true, "string": "true", "display": "Yes"},
            {"type": false, "string": "false", "display": "No"},
            {"type": null, "string": "null", "display": "Unsure"}
        ] %}
        <div class="col-xs-1">
          <div class="submission-option">
            <input type="radio" name="{{qu.id}}" value="{{ val.string }}" {% if formData %}{% if formData[qu.id] == val.string %}checked="true"{% endif %}{% else %}{% if (current and current.answers[qu.id] == val.type) %}checked="true" {% endif %}{% endif %}class="{{ val.string }}"{% if canReview != true or reviewClosed %} disabled="disabled"{% endif %} required>
          </div>
        </div>
        {% endfor %}
        <div class="submission-current col-xs-2">
            {% for val in [
              {"type": true, "string": "true", "display": "Yes"},
              {"type": false, "string": "false", "display": "No"},
              {"type": null, "string": "null", "display": "Unsure"}
            ] %}
            {% if current.answers[qu.id] == val.type %}
            {% set currentDisplay = val.display %}
            {% endif %}
            {% endfor %}
            {{ currentDisplay or gettext('No entry') }}
        </div>
        <div class="submission-info col-xs-4">
          <span class="help-block readmore">{{qu.description}}</span>
        </div>
      </div>
      <div class="row">
        {% if qu.dependants %}
        {% for dependant in qu.dependants %}
        <div class="row submission-dependant">
          {{ question(dependant) }}
        </div>
        {% endfor %}
        {% endif %}
      </div>
    </div>
    {% endif %}
    {% endfor %}
  </div>

</fieldset>

<fieldset>

  <div class="row">
    <div class="col-xs-12">
      <hr />
      <h4>{{addDetails.question}}</h4>
      <span class="help-block">{{addDetails.description}}</span>
    </div>
    <div class="col-xs-6">
      <div class="wmd-panel">
        <div id="wmd-button-bar"></div>
        <textarea class="wmd-input" id="wmd-input" name="details" {% if canReview != true or reviewClosed %}disabled="disabled"{% endif %} style="min-height: 150px;">{{formData.details or current.details}}</textarea>
      </div>
    </div>
    <div class="col-xs-6">
      <h4>{{ gettext("Preview")}}</h4>
      <div id="wmd-preview" class="wmd-panel wmd-preview"></div>
    </div>
    <div class="col-xs-12">
      {{ currentEntry(addDetails) }}
    </div>
  </div>
</fieldset>


<fieldset class="data-details">
  <datalist id="formats">
    <option value="CSV">
    <option value="Excel">
    <option value="HTML">
    <option value="PDF">
    <option value="json">
    <option value="geojson">
    <option value="shapefiles">
  </datalist>
</fieldset>
